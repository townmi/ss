<div class="page-header">
    <h1>âš™ï¸ è®¤è¯è®¾ç½®</h1>
    <p>é…ç½®ç³»ç»Ÿè®¤è¯å’Œå®‰å…¨ç­–ç•¥</p>
</div>

<div class="settings-container">
    <div class="settings-nav">
        <h3>è®¾ç½®åˆ†ç±»</h3>
        <ul class="settings-menu">
            <li><a href="#basic-settings" class="active">åŸºæœ¬è®¾ç½®</a></li>
            <li><a href="#security-settings">å®‰å…¨ç­–ç•¥</a></li>
            <li><a href="#password-settings">å¯†ç è§„åˆ™</a></li>
            <li><a href="#session-settings">ä¼šè¯ç®¡ç†</a></li>
            <li><a href="#notification-settings">é€šçŸ¥è®¾ç½®</a></li>
        </ul>
    </div>

    <div class="settings-content">
        <!-- åŸºæœ¬è®¾ç½® -->
        <section id="basic-settings" class="settings-section active">
            <h2 class="section-title">åŸºæœ¬è®¾ç½®</h2>
            
            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">å¯ç”¨ç”¨æˆ·æ³¨å†Œ</span>
                    <span class="label-desc">å…è®¸æ–°ç”¨æˆ·è‡ªè¡Œæ³¨å†Œè´¦å·</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="enableRegistration" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">éœ€è¦é‚®ç®±éªŒè¯</span>
                    <span class="label-desc">æ–°ç”¨æˆ·æ³¨å†Œåå¿…é¡»éªŒè¯é‚®ç®±æ‰èƒ½ç™»å½•</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="requireEmailVerification">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">é»˜è®¤ç”¨æˆ·è§’è‰²</span>
                    <span class="label-desc">æ–°æ³¨å†Œç”¨æˆ·çš„é»˜è®¤è§’è‰²</span>
                </label>
                <div class="setting-control">
                    <select id="defaultRole" class="form-select">
                        <option value="user">æ™®é€šç”¨æˆ·</option>
                        <option value="member">ä¼šå‘˜</option>
                        <option value="guest">è®¿å®¢</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- å®‰å…¨ç­–ç•¥ -->
        <section id="security-settings" class="settings-section">
            <h2 class="section-title">å®‰å…¨ç­–ç•¥</h2>
            
            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶</span>
                    <span class="label-desc">è¿ç»­å¤±è´¥åé”å®šè´¦å·</span>
                </label>
                <div class="setting-control">
                    <input type="number" id="maxLoginAttempts" class="form-input" value="5" min="3" max="10">
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">è´¦å·é”å®šæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</span>
                    <span class="label-desc">è´¦å·è¢«é”å®šåçš„è§£é”æ—¶é—´</span>
                </label>
                <div class="setting-control">
                    <input type="number" id="lockoutDuration" class="form-input" value="30" min="5" max="1440">
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">å¯ç”¨ IP é»‘åå•</span>
                    <span class="label-desc">è‡ªåŠ¨å°ç¦æ¶æ„ IP åœ°å€</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="enableIpBlacklist" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">åŒå› ç´ è®¤è¯</span>
                    <span class="label-desc">è¦æ±‚ç”¨æˆ·å¯ç”¨åŒå› ç´ è®¤è¯</span>
                </label>
                <div class="setting-control">
                    <select id="twoFactorAuth" class="form-select">
                        <option value="optional">å¯é€‰</option>
                        <option value="required">å¿…éœ€</option>
                        <option value="disabled">ç¦ç”¨</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- å¯†ç è§„åˆ™ -->
        <section id="password-settings" class="settings-section">
            <h2 class="section-title">å¯†ç è§„åˆ™</h2>
            
            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">æœ€å°å¯†ç é•¿åº¦</span>
                    <span class="label-desc">å¯†ç çš„æœ€å°‘å­—ç¬¦æ•°</span>
                </label>
                <div class="setting-control">
                    <input type="number" id="minPasswordLength" class="form-input" value="8" min="6" max="32">
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">éœ€è¦å¤§å†™å­—æ¯</span>
                    <span class="label-desc">å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="requireUppercase" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">éœ€è¦æ•°å­—</span>
                    <span class="label-desc">å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="requireNumbers" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">éœ€è¦ç‰¹æ®Šå­—ç¬¦</span>
                    <span class="label-desc">å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="requireSpecialChars">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">å¯†ç è¿‡æœŸå¤©æ•°</span>
                    <span class="label-desc">å¯†ç å¿…é¡»å®šæœŸæ›´æ¢ï¼ˆ0 è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼‰</span>
                </label>
                <div class="setting-control">
                    <input type="number" id="passwordExpireDays" class="form-input" value="0" min="0" max="365">
                </div>
            </div>
        </section>

        <!-- ä¼šè¯ç®¡ç† -->
        <section id="session-settings" class="settings-section">
            <h2 class="section-title">ä¼šè¯ç®¡ç†</h2>
            
            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">ä¼šè¯è¶…æ—¶ï¼ˆåˆ†é’Ÿï¼‰</span>
                    <span class="label-desc">ç”¨æˆ·æ— æ´»åŠ¨åè‡ªåŠ¨ç™»å‡º</span>
                </label>
                <div class="setting-control">
                    <input type="number" id="sessionTimeout" class="form-input" value="60" min="5" max="1440">
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">è®°ä½ç™»å½•å¤©æ•°</span>
                    <span class="label-desc">"è®°ä½æˆ‘"åŠŸèƒ½çš„æœ‰æ•ˆæœŸ</span>
                </label>
                <div class="setting-control">
                    <input type="number" id="rememberMeDays" class="form-input" value="30" min="1" max="90">
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">å•è®¾å¤‡ç™»å½•</span>
                    <span class="label-desc">åŒä¸€è´¦å·åªèƒ½åœ¨ä¸€ä¸ªè®¾å¤‡ä¸Šç™»å½•</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="singleDeviceLogin">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </section>

        <!-- é€šçŸ¥è®¾ç½® -->
        <section id="notification-settings" class="settings-section">
            <h2 class="section-title">é€šçŸ¥è®¾ç½®</h2>
            
            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">ç™»å½•é€šçŸ¥</span>
                    <span class="label-desc">æ–°è®¾å¤‡ç™»å½•æ—¶å‘é€é‚®ä»¶é€šçŸ¥</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="loginNotification" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">å¼‚å¸¸æ´»åŠ¨é€šçŸ¥</span>
                    <span class="label-desc">æ£€æµ‹åˆ°å¼‚å¸¸æ´»åŠ¨æ—¶é€šçŸ¥ç”¨æˆ·</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="anomalyNotification" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span class="label-text">å¯†ç ä¿®æ”¹é€šçŸ¥</span>
                    <span class="label-desc">å¯†ç è¢«ä¿®æ”¹æ—¶å‘é€ç¡®è®¤é‚®ä»¶</span>
                </label>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="passwordChangeNotification" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </section>

        <div class="settings-actions">
            <button class="btn btn-primary" onclick="saveSettings()">
                <span class="btn-icon">ğŸ’¾</span> ä¿å­˜è®¾ç½®
            </button>
            <button class="btn btn-secondary" onclick="resetSettings()">
                <span class="btn-icon">â†©ï¸</span> æ¢å¤é»˜è®¤
            </button>
        </div>
    </div>
</div>

<script>
// è®¾ç½®å¯¼èˆªåˆ‡æ¢
document.addEventListener('DOMContentLoaded', function() {
    const menuItems = document.querySelectorAll('.settings-menu a');
    const sections = document.querySelectorAll('.settings-section');
    
    menuItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            
            // æ›´æ–°èœå•çŠ¶æ€
            menuItems.forEach(mi => mi.classList.remove('active'));
            this.classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”éƒ¨åˆ†
            sections.forEach(section => {
                if (section.id === targetId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
        });
    });
});

// ä¿å­˜è®¾ç½®
function saveSettings() {
    const settings = {
        basic: {
            enableRegistration: document.getElementById('enableRegistration').checked,
            requireEmailVerification: document.getElementById('requireEmailVerification').checked,
            defaultRole: document.getElementById('defaultRole').value
        },
        security: {
            maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value),
            lockoutDuration: parseInt(document.getElementById('lockoutDuration').value),
            enableIpBlacklist: document.getElementById('enableIpBlacklist').checked,
            twoFactorAuth: document.getElementById('twoFactorAuth').value
        },
        password: {
            minPasswordLength: parseInt(document.getElementById('minPasswordLength').value),
            requireUppercase: document.getElementById('requireUppercase').checked,
            requireNumbers: document.getElementById('requireNumbers').checked,
            requireSpecialChars: document.getElementById('requireSpecialChars').checked,
            passwordExpireDays: parseInt(document.getElementById('passwordExpireDays').value)
        },
        session: {
            sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
            rememberMeDays: parseInt(document.getElementById('rememberMeDays').value),
            singleDeviceLogin: document.getElementById('singleDeviceLogin').checked
        },
        notification: {
            loginNotification: document.getElementById('loginNotification').checked,
            anomalyNotification: document.getElementById('anomalyNotification').checked,
            passwordChangeNotification: document.getElementById('passwordChangeNotification').checked
        }
    };
    
    // å‘é€ä¿å­˜è¯·æ±‚
    fetch('/auth/settings', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('è®¾ç½®ä¿å­˜æˆåŠŸï¼');
        } else {
            alert('ä¿å­˜å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
        }
    })
    .catch(error => {
        alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
    });
}

// æ¢å¤é»˜è®¤è®¾ç½®
function resetSettings() {
    if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤è®¾ç½®å—ï¼Ÿ')) {
        // æ¢å¤å„é¡¹è®¾ç½®çš„é»˜è®¤å€¼
        document.getElementById('enableRegistration').checked = true;
        document.getElementById('requireEmailVerification').checked = false;
        document.getElementById('defaultRole').value = 'user';
        
        document.getElementById('maxLoginAttempts').value = '5';
        document.getElementById('lockoutDuration').value = '30';
        document.getElementById('enableIpBlacklist').checked = true;
        document.getElementById('twoFactorAuth').value = 'optional';
        
        document.getElementById('minPasswordLength').value = '8';
        document.getElementById('requireUppercase').checked = true;
        document.getElementById('requireNumbers').checked = true;
        document.getElementById('requireSpecialChars').checked = false;
        document.getElementById('passwordExpireDays').value = '0';
        
        document.getElementById('sessionTimeout').value = '60';
        document.getElementById('rememberMeDays').value = '30';
        document.getElementById('singleDeviceLogin').checked = false;
        
        document.getElementById('loginNotification').checked = true;
        document.getElementById('anomalyNotification').checked = true;
        document.getElementById('passwordChangeNotification').checked = true;
    }
}
</script> 