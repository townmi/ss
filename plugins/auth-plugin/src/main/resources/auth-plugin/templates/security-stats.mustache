<div class="page-header">
    <h1>
        <span>ğŸ›¡ï¸</span>
        <span>å®‰å…¨ç»Ÿè®¡åˆ†æ</span>
    </h1>
    <div class="breadcrumb">
        <a href="/auth/">è®¤è¯ç®¡ç†</a> / å®‰å…¨ç»Ÿè®¡
    </div>
</div>

<div class="filters">
    <div class="filter-group">
        <label>æ—¶é—´èŒƒå›´ï¼š</label>
        <select id="timeRange">
            <option value="24">è¿‡å»24å°æ—¶</option>
            <option value="72">è¿‡å»3å¤©</option>
            <option value="168">è¿‡å»7å¤©</option>
            <option value="720">è¿‡å»30å¤©</option>
        </select>
    </div>
    <div class="filter-group">
        <label>é£é™©ç­‰çº§ï¼š</label>
        <select id="riskLevel">
            <option value="">å…¨éƒ¨</option>
            <option value="low">ä½é£é™©</option>
            <option value="medium">ä¸­é£é™©</option>
            <option value="high">é«˜é£é™©</option>
        </select>
    </div>
    <button class="btn btn-primary" onclick="refreshStats()">åˆ·æ–°æ•°æ®</button>
</div>

<div class="stats-overview">
    <div class="stat-box success">
        <div class="label">æˆåŠŸç™»å½•</div>
        <div class="value">{{stats.successLogins}}</div>
    </div>
    <div class="stat-box warning">
        <div class="label">å¤±è´¥å°è¯•</div>
        <div class="value">{{stats.failedLogins}}</div>
    </div>
    <div class="stat-box danger">
        <div class="label">è¢«é˜»æ­¢ç™»å½•</div>
        <div class="value">{{stats.blockedLogins}}</div>
    </div>
    <div class="stat-box">
        <div class="label">æˆåŠŸç‡</div>
        <div class="value">{{stats.successRate}}%</div>
    </div>
</div>

<div class="chart-container">
    <h2>ç™»å½•è¶‹åŠ¿å›¾</h2>
    <div class="chart-placeholder">
        <canvas id="loginTrendChart">ç™»å½•è¶‹åŠ¿å›¾è¡¨</canvas>
    </div>
</div>

<div class="data-table">
    <h2>é«˜é£é™©ç™»å½•è®°å½•</h2>
    {{#highRiskLogins}}
    <table>
        <thead>
            <tr>
                <th>æ—¶é—´</th>
                <th>ç”¨æˆ·</th>
                <th>IPåœ°å€</th>
                <th>é£é™©è¯„åˆ†</th>
                <th>çŠ¶æ€</th>
                <th>åŸå› </th>
            </tr>
        </thead>
        <tbody>
            {{#items}}
            <tr>
                <td>{{time}}</td>
                <td>{{identifier}}</td>
                <td>{{clientIp}}</td>
                <td>
                    <span class="risk-badge {{riskLevel}}">{{riskScore}}</span>
                </td>
                <td>
                    <span class="status-indicator {{statusClass}}"></span>
                    {{status}}
                </td>
                <td>{{reason}}</td>
            </tr>
            {{/items}}
        </tbody>
    </table>
    {{/highRiskLogins}}
    {{^highRiskLogins}}
    <div class="empty-state">
        <div class="icon">ğŸ‰</div>
        <p>æš‚æ— é«˜é£é™©ç™»å½•è®°å½•</p>
    </div>
    {{/highRiskLogins}}
</div>

<div class="data-table">
    <h2>æœ€æ´»è·ƒçš„IPåœ°å€</h2>
    {{#topActiveIps}}
    <table>
        <thead>
            <tr>
                <th>IPåœ°å€</th>
                <th>è¯·æ±‚æ¬¡æ•°</th>
                <th>æˆåŠŸæ¬¡æ•°</th>
                <th>å¤±è´¥æ¬¡æ•°</th>
                <th>æœ€åæ´»åŠ¨</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {{#items}}
            <tr>
                <td>{{ip}}</td>
                <td>{{totalAttempts}}</td>
                <td style="color: #4caf50;">{{successCount}}</td>
                <td style="color: #f44336;">{{failedCount}}</td>
                <td>{{lastActivity}}</td>
                <td>
                    <button class="btn btn-primary" onclick="viewIpDetails('{{ip}}')">æŸ¥çœ‹è¯¦æƒ…</button>
                </td>
            </tr>
            {{/items}}
        </tbody>
    </table>
    {{/topActiveIps}}
    {{^topActiveIps}}
    <div class="empty-state">
        <div class="icon">ğŸ“Š</div>
        <p>æš‚æ— IPæ´»åŠ¨æ•°æ®</p>
    </div>
    {{/topActiveIps}}
</div>

<div class="actions">
    <a href="/auth/admin/security/export" class="btn btn-primary">å¯¼å‡ºæŠ¥å‘Š</a>
    <a href="/auth/" class="btn">è¿”å›</a>
</div>

<script>
    function refreshStats() {
        const timeRange = document.getElementById('timeRange').value;
        const riskLevel = document.getElementById('riskLevel').value;
        window.location.href = `/auth/admin/security/page?hours=${timeRange}&riskLevel=${riskLevel}`;
    }
    
    function viewIpDetails(ip) {
        window.location.href = `/auth/admin/security/ip/${ip}`;
    }
    
    // ç®€å•çš„å›¾è¡¨ç»˜åˆ¶ç¤ºä¾‹
    window.onload = function() {
        const canvas = document.getElementById('loginTrendChart');
        if (canvas && canvas.getContext) {
            const ctx = canvas.getContext('2d');
            // è¿™é‡Œå¯ä»¥é›†æˆ Chart.js æˆ–å…¶ä»–å›¾è¡¨åº“
            ctx.fillStyle = '#667eea';
            ctx.fillRect(50, 50, 100, 100);
            ctx.fillText('ç™»å½•è¶‹åŠ¿å›¾è¡¨å ä½', 200, 150);
        }
    };
</script> 